<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BLE Test</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
    <div class="container mt-5">
        <h2 class="text-center">BLE Device Tester</h2>
        <button class="btn btn-primary" onclick="connectToDevice()">Kết nối thiết bị</button>
        <div id="device-info" class="mt-3"></div>
        <button class="btn btn-warning mt-2" onclick="sendNotification()">Gửi thông báo</button>
        <div class="mt-3">
            <label for="mtuSize">Thay đổi ATT MTU:</label>
            <input type="number" id="mtuSize" class="form-control w-25" value="23">
            <button class="btn btn-info mt-2" onclick="changeMTU()">Cập nhật</button>
        </div>
        <table class="table table-bordered mt-3">
            <thead>
                <tr>
                    <th>Loại câu lệnh</th>
                    <th>Thông lượng</th>
                    <th>Thời gian truyền</th>
                </tr>
            </thead>
            <tbody id="command-log"></tbody>
        </table>
    </div>
    <script>
        let device;
        async function connectToDevice() {
            try {
                device = await navigator.bluetooth.requestDevice({ acceptAllDevices: true });
                document.getElementById('device-info').innerHTML = `
                    <p><strong>Thiết bị:</strong> ${device.name || 'Không có tên'}</p>
                    <p><strong>Thời gian kết nối:</strong> ${new Date().toLocaleTimeString()}</p>
                `;
            } catch (error) {
                alert("Lỗi kết nối: " + error);
            }
        }
        
        function sendNotification() {
            if (!device) return alert("Chưa kết nối thiết bị!");
            logCommand("Gửi thông báo", "N/A", new Date().toLocaleTimeString());
            alert("Thông báo đã được gửi!");
        }
        
        function changeMTU() {
            let mtuSize = document.getElementById('mtuSize').value;
            logCommand("Thay đổi MTU", mtuSize, new Date().toLocaleTimeString());
            alert("ATT MTU cập nhật: " + mtuSize);
        }
        
        function logCommand(type, throughput, time) {
            let row = `<tr><td>${type}</td><td>${throughput}</td><td>${time}</td></tr>`;
            document.getElementById('command-log').innerHTML += row;
        }
    </script>
</body>
</html>
